---
title: "enrichmeta Tutorial: Metabolite Enrichment Analysis with KEGG Pathways"
author: "Botao Zhang"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{enrichmeta Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

The `enrichmeta` package provides tools for metabolite enrichment analysis using KEGG pathways. This tutorial demonstrates the main functionality:

1. Retrieving KEGG pathway data with caching
2. Performing enrichment analysis
3. Visualizing results
4. Analyzing shared metabolites between pathways

## Installation

```{r install, eval = FALSE}
# Install from GitHub
devtools::install_github("maxgodson1/enrichmeta")
```

## Load Package

```{r library}
library(enrichmeta)
```

## Step 1: Get KEGG Pathway Data

Use `getkeggdata()` to retrieve pathway data for a species. Data is cached locally for future use.

```{r get_data}
# Get data for zebrafish (Danio rerio)
kegg_data <- getkeggdata("dre", cache_dir = "./kegg_cache")

# Explore data structure
names(kegg_data)
```

- `pathways`: Named list of pathway names (ID -> name)
- `path_cpd_map`: List of metabolites per pathway (ID -> vector of compounds)
- `compounds`: Named list of compound names (ID -> name)

## Step 2: Enrichment Analysis

Perform enrichment analysis with `enrichkegg()` using a set of metabolite KEGG IDs.

```{r enrichment}
# Example metabolite IDs (Pyruvate, Lactate, etc.)
sig_metabolites <- c("C00022", "C00031", "C00186", "C00256", "C00041")

# Run enrichment
enrich_results <- enrichkegg(
  keggid = sig_metabolites,
  pathway_data = kegg_data
)

# View results (sorted by adjusted p-value)
head(enrich_results)
```

## Step 3: Visualize Enrichment Results

### Bar Plot

```{r bar_plot, fig.width=8, fig.height=6}
plotenrichbar(
  results = enrich_results,
  top = 10,
  title = "Top Enriched Pathways in Zebrafish"
)
```

### Dot Plot

```{r dot_plot, fig.width=8, fig.height=6}
plotenrichdot(
  results = enrich_results,
  top = 10,
  title = "Enriched Pathways in Zebrafish"
)
```

## Step 4: Pathway-Metabolite Mapping

### Find Pathways for Metabolites

```{r find_paths}
# Get pathways containing specific metabolites
metab_paths <- findcpdspaths(c("C00022", "C00031"), pathway_data = kegg_data)
metab_paths
```

### Find Metabolites in Pathways

```{r find_cpds}
# Get metabolites in specific pathways
path_cpds <- findpathscpds(c("dre00010", "dre00020"), pathway_data = kegg_data)
head(path_cpds)
```

## Step 5: Shared Metabolites Between Pathways

Analyze metabolite sharing between enriched pathways:

```{r shared_cpds}
# Get top 5 enriched pathway IDs
top_paths <- head(enrich_results$pathwayID, 5)

# Find shared metabolites
shared_df <- findsharedcpds(
  pathwayid = top_paths,
  pathway_data = kegg_data,
  min_shared = 1
)

# View results
head(shared_df)

# Map compound IDs to names
if (nrow(shared_df) > 0) {
  shared_metabs <- unique(unlist(strsplit(shared_df$keggID, ";")))
  findcpdsnames(shared_metabs, kegg_data)
}
```

## Conclusion

This tutorial covered the core functionality of `enrichmeta`. For advanced usage, see the function documentation:
```{r help, eval=FALSE}
help(package = "enrichmeta")
```
